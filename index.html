<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Kostyuk Project | Premium Magic</title>

<meta name="description" content="Премиальное шоу иллюзиониста Дмитрия Костюка.">
<meta name="theme-color" content="#050505">

<link rel="preload" as="image" href="images/hero-portrait.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Manrope:wght@300;400;600;800&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<style>
/* === КОМПАКТНЫЙ ДИЗАЙН === */
:root {
  --bg: #050505;
  --bg-panel: rgba(20, 20, 22, 0.95);
  --text: #F2F2F2;
  --gold-primary: #D4AF37;
  --gold-light: #F8E79B;
  --gold-dark: #8A6E2F;
  --gradient-gold: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-light) 50%, var(--gold-dark) 100%);
  --container: min(1000px, 94vw);
  --ff-head: 'Cinzel', serif;
  --ff-body: 'Manrope', sans-serif;
  --radius: 12px;
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html { -webkit-font-smoothing: antialiased; scroll-behavior: smooth; font-size: 14px; }
body {
  font-family: var(--ff-body); background: var(--bg); color: var(--text);
  line-height: 1.4; overflow-x: hidden; margin: 0;
  height: 100vh; overflow-y: hidden;
}
body.loaded { overflow-y: auto; height: auto; }

/* UTILS */
.container { width: var(--container); margin: 0 auto; position: relative; z-index: 2; }
.section-py { padding-block: 40px; }
.text-center { text-align: center; }
.icon-svg { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 2; }

/* BUTTONS */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  padding: 10px 20px; border-radius: 50px; font-weight: 700; font-size: 0.85rem;
  text-transform: uppercase; letter-spacing: 0.05em; transition: 0.3s;
  position: relative; overflow: hidden; z-index: 1; border:none; outline:none; cursor: pointer; text-decoration: none;
}
.btn-primary { background: var(--gradient-gold); color: #000; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2); }
.btn-primary:hover { box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4); transform: translateY(-2px); }
.btn-glass { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff; backdrop-filter: blur(4px); }
.btn-glass:hover { border-color: var(--gold-primary); background: rgba(255,255,255,0.1); }

/* INPUTS & SELECTS */
.input-field, select, input {
  width: 100%; background: rgba(20,20,20,0.8); border: 1px solid #333;
  padding: 12px; border-radius: 10px; color: #fff; font-size: 0.9rem; margin-bottom: 10px;
  backdrop-filter: blur(5px); outline: none; font-family: var(--ff-body);
}
.input-field:focus, select:focus, input:focus { border-color: var(--gold-primary); }
label { display: block; margin-bottom: 5px; font-size: 0.75rem; color: #888; text-transform: uppercase; letter-spacing: 0.05em; }

/* HEADER */
.header { position: fixed; top: 0; inset-inline: 0; z-index: 100; padding: 10px 0; background: rgba(5,5,5,0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.05); }
.nav-flex { display: flex; justify-content: space-between; align-items: center; }
.logo { font-family: var(--ff-head); font-size: 1.2rem; font-weight: 900; color: #fff; text-decoration: none; }
.logo span { color: var(--gold-primary); margin-left: 4px; }
.burger { width: 32px; height: 32px; background: none; display: flex; flex-direction: column; justify-content: center; gap: 5px; border:none; cursor:pointer; }
.burger span { width: 22px; height: 2px; background: #fff; align-self: flex-end; transition: 0.3s; }
.burger.active span:nth-child(2) { opacity: 0; }
.burger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
.burger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

/* MENU */
.mobile-menu {
  position: fixed; inset: 0; background: #000; z-index: 99;
  display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 1rem;
  transform: translateY(-100%); transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); padding: 20px;
}
.mobile-menu.open { transform: translateY(0); }
.nav-card {
  width: 100%; max-width: 320px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
  text-decoration: none; text-align: center; transition: 0.3s; position: relative; overflow: hidden;
  background: #111; cursor: pointer; display: block;
}
.nav-card.gold { border-color: var(--gold-primary); background: linear-gradient(135deg, rgba(212,175,55,0.1), #000); }
.nav-card.gold h3 { color: #fff; } .nav-card.gold span { color: var(--gold-primary); }
.nav-card.silver { border-color: #555; background: linear-gradient(135deg, rgba(255,255,255,0.05), #000); }
.nav-card.silver h3 { color: #fff; } .nav-card.silver span { color: #aaa; }
.nav-card h3 { font-family: var(--ff-head); font-size: 1.2rem; margin: 5px 0 0; line-height: 1.2; text-transform: uppercase; }
.nav-card span { text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.2em; font-weight: 700; opacity: 0.8; }

/* HERO */
.hero { height: 100dvh; min-height: 500px; display: flex; align-items: flex-end; padding-bottom: 90px; position: relative; overflow: hidden; }
.hero-img {
  position: absolute; right: 0; bottom: 0; height: 100%; width: 100%;
  background-image: url('images/hero-portrait.png'); 
  background-size: contain; background-repeat: no-repeat; background-position: bottom center;
  pointer-events: none; z-index: 1; opacity: 0;
}
#webgl-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; opacity: 0.6; }
@media (max-width: 768px) { 
    .hero { padding-bottom: 70px; align-items: center; justify-content: center; text-align: center; }
    .hero-img { width: 100%; height: 100%; background-size: cover; background-position: center top; opacity: 0.5; } 
    .hero-content { margin: 0; padding-top: 40px; }
    .hero-btns { justify-content: center; }
}

.hero-content { max-width: 600px; position: relative; z-index: 3; width: 100%; }
.hero-title { font-family: var(--ff-head); font-size: clamp(28px, 7vw, 56px); line-height: 1.1; margin-bottom: 12px; }
.hero-desc { font-size: 0.95rem; color: #ddd; text-shadow: 0 2px 5px rgba(0,0,0,0.9); margin-bottom: 25px; max-width: 400px; margin-inline: auto; }
.hero-btns { display:flex; gap:12px; flex-wrap:wrap; }

/* PARTNERS */
.partners-section { padding: 25px 0; border-bottom: 1px solid #222; overflow: hidden; background: rgba(8,8,8,0.8); position:relative; z-index:2; }
.partners-track { display: flex; gap: 30px; width: max-content; animation: scrollLogos 30s linear infinite; }
.partner-logo { height: 24px; width: auto; opacity: 0.9; flex-shrink: 0; display: block; }
@keyframes scrollLogos { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

/* CARDS */
.grid-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; }
.card {
  padding: 20px; background: var(--bg-panel); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px;
  display: flex; flex-direction: column;
}
.card:hover { border-color: var(--gold-primary); }
.card-icon-wrap { margin-bottom: 12px; color: var(--gold-primary); }
.card h3 { font-family: var(--ff-head); font-size: 1.2rem; margin-bottom: 6px; color: #fff; }
.card-price { display: block; font-size: 0.9rem; color: var(--gold-primary); font-weight: 700; margin-bottom: 12px; }
.card ul li { padding-left: 15px; margin-bottom: 5px; color: #aaa; list-style: none; position: relative; font-size: 0.85rem; }
.card ul li::before { content: ''; position: absolute; left: 0; top: 7px; width: 5px; height: 5px; background: var(--gold-primary); border-radius: 50%; }

/* CALCULATOR (FIXED FROM SITE.HTML) */
.wizard-box {
  background: var(--bg-panel); border-radius: 16px; border: 1px solid #222; overflow: hidden;
  min-height: 450px; display: flex; flex-direction: column;
}
.wizard-progress { height: 3px; background: #222; width: 100%; }
.progress-bar { height: 100%; background: var(--gradient-gold); width: 33%; transition: 0.5s; }
.wizard-step { padding: 20px; display: none; flex: 1; flex-direction: column; animation: slideIn 0.3s ease; overflow-y: auto; }
.wizard-step.active { display: flex; }
@keyframes slideIn { from{opacity:0; transform:translateX(10px)} to{opacity:1; transform:translateX(0)} }
.step-title { font-family: var(--ff-head); font-size: 1.2rem; margin-bottom: 15px; color: #fff; text-align: center; }
.wiz-controls { margin-top: auto; display: flex; gap: 8px; padding-top: 15px; border-top: 1px solid #222; }

/* Калькулятор: стили для селектов и слайдера */
#slider { display: none; flex-direction: column; gap: 5px; margin-bottom: 15px; }
#desc { font-size: 0.85rem; color: #ccc; margin-bottom: 15px; min-height: 20px; text-align: center; }
.total { display: none; font-family: var(--ff-head); font-size: 1.4rem; color: var(--gold-primary); text-align: center; margin-top: 15px; }
.breakdown { display: none; font-size: 0.85rem; color: #aaa; margin-top: 10px; line-height: 1.4; border-top: 1px dashed #333; padding-top: 10px; }
.afterCalc { display: none; gap: 10px; justify-content: center; margin-top: 15px; }

/* GAME */
.game-section { text-align: center; border-block: 1px solid #222; background: rgba(0,0,0,0.6); padding: 30px 0; }
.deck { display: flex; justify-content: center; gap: 10px; margin: 20px 0; perspective: 800px; }
.card-play { width: 70px; height: 100px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer; }
.card-play.flipped { transform: rotateY(180deg); }
.face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: bold; background: #fff; }
.back { background: linear-gradient(135deg, #111, #333); border: 2px solid var(--gold-primary); transform: rotateY(0deg); z-index: 2; }
.front { transform: rotateY(180deg); color: #000; }

/* REVIEWS & FAQ */
.faq-grid { display: grid; gap: 10px; }
details { background: var(--bg-panel); border: 1px solid #222; border-radius: 10px; padding: 12px; }
details[open] { border-color: var(--gold-primary); }
summary { font-weight: 700; cursor: pointer; color: #fff; font-size: 0.9rem; padding-right: 20px; position: relative; list-style: none; }
summary::after { content: '+'; position: absolute; right: 0; color: var(--gold-primary); }
details[open] summary::after { content: '-'; }
details p { margin-top: 8px; font-size: 0.85rem; color: #aaa; margin-bottom: 0; }
.faq-item.hidden { display: none; }
.faq-controls { text-align: center; margin-top: 15px; }

.reviews-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
.tg-review-item { display: flex; flex-direction: column; align-items: center; width: 100px; }
.tg-circle { width: 80px; height: 80px; border-radius: 50%; overflow: hidden; border: 2px solid var(--gold-primary); cursor: pointer; margin-bottom: 8px; flex-shrink: 0; }
.tg-circle video { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
.review-author { font-weight: 700; color: #fff; font-size: 0.8rem; text-align:center; }

/* GALLERY */
.gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
.gallery-grid img { width: 100%; height: 130px; object-fit: cover; border-radius: 8px; filter: grayscale(30%); transition: 0.5s; cursor: pointer; background: #111; }
.gallery-grid img:hover { filter: grayscale(0); }

/* FOOTER */
footer { text-align:center; padding:20px 0; color:#444; font-size:0.7rem; border-top: 1px solid #111; }

/* MODALS */
.modal { position: fixed; inset: 0; z-index: 200; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
.modal.open { display: flex; }
.close-btn { position: absolute; top: 15px; right: 15px; color: #fff; font-size: 2rem; background: none; border: none; cursor: pointer; z-index: 201; }

/* SCHOOL MODAL SPECIFIC */
.school-modal-content {
  background: linear-gradient(135deg, #0D1424, #000);
  padding: 30px 20px; border-radius: 20px; border: 1px solid #333;
  width: 100%; max-width: 900px; height: 90vh; overflow-y: auto; position: relative;
}
.school-hero-inner { text-align: center; margin-bottom: 30px; }
.school-levels { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
.level-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; text-align: center; }
.level-card h4 { font-family: var(--ff-head); font-size: 1.1rem; color: #fff; margin-bottom: 10px; }
.level-card ul { list-style: none; padding: 0; font-size: 0.85rem; color: #aaa; text-align: left; margin-bottom: 10px; }
.level-price { font-size: 1rem; color: var(--gold-primary); font-weight: 700; }

/* PRELOADER */
.curtain-wrapper { position: fixed; inset: 0; z-index: 10000; display: flex; pointer-events: none; background: transparent; transition: opacity 1s ease, visibility 1s ease; }
.curtain-wrapper.finished { opacity: 0; visibility: hidden; }
.curtain-bg { position: absolute; inset: 0; background: #000; z-index: 1; transition: opacity 1s ease; }
.curtain-panel { width: 50%; height: 100%; position: relative; z-index: 2; background-color: #4a0404; background-image: repeating-linear-gradient(90deg, rgba(0,0,0,0.8) 0%, rgba(80,0,0,0.5) 15%, rgba(0,0,0,0.8) 50%); transform-origin: top; will-change: transform; }
.curtain-content { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); z-index: 10; text-align: center; width: 100%; }
.curtain-text { font-family: var(--ff-head); font-size: clamp(2rem, 5vw, 4rem); font-weight: 900; color: transparent; background: linear-gradient(to bottom, #FFF5C3, #D4AF37); -webkit-background-clip: text; background-clip: text; }
</style>
</head>
<body>

<div class="magic-cursor"></div>

<div class="curtain-wrapper">
  <div class="curtain-bg"></div>
  <div class="curtain-panel left"></div>
  <div class="curtain-panel right"></div>
  <div class="curtain-content">
    <div class="curtain-text">KOSTYUK PROJECT</div>
  </div>
</div>

<canvas id="webgl-canvas"></canvas>

<header class="header">
  <div class="container nav-flex">
    <a href="#" class="logo">KOSTYUK <span>PROJECT</span></a>
    <button class="burger" onclick="toggleMenu()">
      <svg class="icon-svg" style="width:32px;height:32px;" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>
  </div>
</header>

<div class="mobile-menu" id="mobileMenu">
  <a href="afisha.html" class="nav-card gold" onclick="toggleMenu()">
    <span>Корпоративы и Праздники</span>
    <h3>КОНЦЕРТНЫЕ ШОУ</h3>
  </a>
  <div style="height: 15px;"></div>
  
  <div class="nav-card silver" onclick="openSchoolModal()">
    <span>Обучение с нуля</span>
    <h3>ШКОЛА ФОКУСОВ</h3>
  </div>
</div>

<section id="hero" class="hero">
  <div class="hero-img"></div>
  <div class="container">
    <div class="hero-content">
      <h1 class="hero-title">Магия <br><span class="text-gold">Высокого Уровня</span></h1>
      <p class="hero-desc">Премиальное шоу для тех, кто видел всё. Интеллектуально. Стильно.</p>
      <div class="hero-btns">
        <button class="btn btn-glass" onclick="openVideo()">
          <svg class="icon-svg" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
          Смотреть промо
        </button>
      </div>
    </div>
  </div>
</section>

<div class="partners-section">
  <div class="container" style="overflow:hidden;">
    <p class="text-center" style="color:#666; font-size:0.65rem; margin-bottom:15px; letter-spacing:0.1em; text-transform:uppercase;">Нам доверяют</p>
    <div class="partners-track">
      <img src="images/logo-gazprom.png" class="partner-logo">
      <img src="images/logo-chery.png" class="partner-logo">
      <img src="images/logo-magnit.png" class="partner-logo">
      <img src="images/logo-rostelecom.png" class="partner-logo">
      <img src="images/logo-yaroslavl.png" class="partner-logo">
      <img src="images/logo-dixy.png" class="partner-logo">
      <img src="images/logo-beeline.png" class="partner-logo">
      <img src="images/logo-perekrestok.png" class="partner-logo">
      <img src="images/logo-megafon.png" class="partner-logo">
      <img src="images/logo-danone.png" class="partner-logo">
      <img src="images/logo-gazprom.png" class="partner-logo">
      <img src="images/logo-chery.png" class="partner-logo">
      <img src="images/logo-magnit.png" class="partner-logo">
      <img src="images/logo-rostelecom.png" class="partner-logo">
    </div>
  </div>
</div>

<section id="formats" class="section-py">
  <div class="container">
    <h2 class="text-center gs-reveal">Форматы</h2>
    <div class="grid-cards">
      <div class="card">
        <div class="card-icon-wrap"><svg class="icon-svg icon-large" viewBox="0 0 24 24"><path d="M8 21h8m-4-4v4m0-4L3 6a2 2 0 0 1 1.7-3h14.6a2 2 0 0 1 1.7 3l-9 11z"></path></svg></div>
        <h3>Микромагия</h3>
        <span class="card-price">от 13 000 ₽</span>
        <ul><li>Welcome-зона</li><li>Фокусы в руках гостей</li></ul>
      </div>
      <div class="card" style="border-color:var(--gold-dark);">
        <div class="card-icon-wrap"><svg class="icon-svg icon-large" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg></div>
        <h3>Сценическое шоу</h3>
        <span class="card-price">от 17 500 ₽</span>
        <ul><li>Интерактив с залом</li><li>Чтение мыслей</li></ul>
      </div>
      <div class="card">
        <div class="card-icon-wrap"><svg class="icon-svg icon-large" viewBox="0 0 24 24"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg></div>
        <h3>Шоу «СЕКРЕТ»</h3>
        <span class="card-price">от 150 000 ₽</span>
        <ul><li>Полноценный концерт</li><li>Атмосферный спектакль</li></ul>
      </div>
    </div>
  </div>
</section>

<section id="calc" class="section-py">
  <div class="container gs-reveal">
    <h2 class="text-center">Калькулятор</h2>
    <div class="wizard-box">
      <div class="wizard-progress"><div class="progress-bar" id="wizProgress"></div></div>
      
      <div class="wizard-step active" id="step1">
        <h3 class="step-title">1. Где и когда?</h3>
        <label>Регион</label>
        <select id="area" class="input-field" onchange="updateCities()"><option value="" disabled selected>Выберите область</option></select>
        <label>Город</label>
        <select id="city" class="input-field" disabled><option>Сначала область</option></select>
        <label>Дата</label>
        <input type="date" id="date" class="input-field">
        <div class="wiz-controls"><button class="btn btn-primary" onclick="nextStep(2)">Далее</button></div>
      </div>
      
      <div class="wizard-step" id="step2">
        <h3 class="step-title">2. Количество гостей</h3>
         <select id="guests" class="input-field" onchange="toggleSlider()">
            <option value="0">до 50</option>
            <option value="5000">51–100</option>
            <option value="10000">101–200</option>
            <option value="custom">свыше 200</option>
        </select>
        <div id="slider">
             <label>Гостей — <span id="gNum">250</span></label>
             <input type="range" id="gRange" min="201" max="500" value="250" class="input-field" style="padding:0; height:4px;" oninput="document.getElementById('gNum').innerText=this.value">
        </div>
        
        <h3 class="step-title" style="margin-top:20px;">3. Услуги</h3>
        <select id="cat" class="input-field" onchange="updateServicesList()"><option value="" disabled selected>Категория</option></select>
        <select id="svc" class="input-field" disabled onchange="showDesc()"><option value="" disabled selected>Программа</option></select>
        <div id="desc"></div>

        <div class="wiz-controls"><button class="btn btn-glass" onclick="nextStep(1)">Назад</button><button class="btn btn-primary" onclick="calcResult()">Рассчитать</button></div>
      </div>
      
      <div class="wizard-step" id="step3">
        <h3 class="step-title text-center">Смета</h3>
        <div class="receipt">
          <div class="receipt-row"><span>Итого</span><span id="rTotal" class="receipt-total">0 ₽</span></div>
          <div class="breakdown" id="breakdown"></div>
        </div>
        <div class="wiz-controls"><a href="#order" class="btn btn-primary" style="width:100%">Забронировать</a><button class="btn btn-glass" onclick="nextStep(2)">Изменить</button></div>
      </div>
    </div>
  </div>
</section>

<section class="section-py game-section">
  <div class="container gs-reveal">
    <h2>Испытай удачу</h2>
    <p style="color:#888;">Найди <span style="color:#fff">Туза Пик</span> и получи скидку.</p>
    <div class="deck" id="gameDeck"></div>
    <div id="gameMsg" style="min-height:24px; color:var(--gold-light); font-weight:bold;"></div>
  </div>
</section>

<section class="section-py">
  <div class="container gs-reveal">
    <h2 class="text-center">Вопросы</h2>
    <div class="faq-grid" id="faqContainer"></div>
  </div>
</section>

<section id="order" class="section-py">
  <div class="container gs-reveal" style="max-width:500px; text-align:center;">
    <h2>Связь</h2>
    <form id="tgForm">
      <input type="text" name="name" placeholder="Ваше Имя" class="input-field" required>
      <input type="tel" name="phone" placeholder="Телефон" class="input-field" required>
      <button class="btn btn-primary" style="width:100%">Отправить</button>
    </form>
  </div>
</section>

<footer style="text-align:center; padding:30px 0; color:#444; font-size:0.7rem;">© 2025 Дмитрий Костюк</footer>

<div id="modalVideo" class="modal">
  <div class="modal-content" style="width:800px; aspect-ratio:16/9; background:#000; padding:0; border:none; position:relative;">
    <button class="close-btn" onclick="closeVideo()" style="right:10px; top:10px; z-index:10; background:rgba(0,0,0,0.5); width:30px; height:30px; border-radius:50%; display:flex; justify-content:center; align-items:center;">×</button>
    <div id="vidContainer" style="width:100%; height:100%"></div>
  </div>
</div>

<div id="schoolModal" class="modal">
  <div class="school-modal-content">
    <button class="close-btn" onclick="closeSchoolModal()">×</button>
    <div class="school-hero-inner">
      <h2 style="font-family:'Cinzel'; color:var(--gold-primary); margin-bottom:10px;">ШКОЛА МАГИИ</h2>
      <p style="color:#ccc; margin-bottom:30px;">Уверенность, харизма и умение управлять вниманием.</p>
      
      <div class="school-levels">
         <div class="level-card">
            <h4>НОВИЧОК</h4>
            <ul><li>Базовые трюки</li><li>Психология</li></ul>
            <span class="level-price">4 900 ₽</span>
         </div>
         <div class="level-card" style="border-color:var(--gold-primary);">
            <h4 style="color:var(--gold-primary)">БАЗОВЫЙ</h4>
            <ul><li>Сцена</li><li>Реквизит</li></ul>
            <span class="level-price">8 900 ₽</span>
         </div>
      </div>

      <form id="schoolFormHero" style="margin-top:30px;">
         <input type="text" name="parent" placeholder="Имя родителя" class="input-field" required>
         <input type="tel" name="phone" placeholder="Телефон" class="input-field" required>
         <button class="btn btn-primary" style="width:100%">ЗАПИСАТЬСЯ</button>
      </form>
    </div>
  </div>
</div>

<script>
/* INIT */
window.addEventListener("DOMContentLoaded", () => {
    if (history.scrollRestoration) history.scrollRestoration = 'manual';
    window.scrollTo(0, 0);

    const tl = gsap.timeline({
        onComplete: () => {
            document.body.classList.add('loaded'); 
            document.querySelector('.hero-img').style.opacity = 1;
            const c = document.querySelector('.curtain-wrapper');
            if(c) { c.style.opacity = 0; setTimeout(() => c.style.display = 'none', 1000); }
        }
    });
    tl.to(".curtain-text", { opacity: 1, scale: 1, duration: 1.2, ease: "power2.out" })
      .to(".curtain-panel.left", { xPercent: -100, duration: 1.5, ease: "power2.inOut" }, "+=0.3")
      .to(".curtain-panel.right", { xPercent: 100, duration: 1.5, ease: "power2.inOut" }, "<")
      .to(".curtain-content", { opacity: 0, duration: 0.5 }, "<")
      .to(".curtain-bg", { opacity: 0, duration: 0.5 }, "-=1.0")
      .from(".hero-title", { y: 50, opacity: 0, duration: 1, ease: "power3.out" }, "-=0.8")
      .from(".hero-desc", { y: 20, opacity: 0, duration: 0.8 }, "-=0.5")
      .from(".hero-btns", { y: 20, opacity: 0, duration: 0.8 }, "-=0.5");

    initThreeJS();
    initGame();
    initCalcData();
    
    // FAQ
    const faqData = [
        {q: "За сколько бронировать?", a: "Обычно за 1–2 недели."},
        {q: "Сколько длится шоу?", a: "От 20 мин до 2 часов."},
        {q: "Работаете по договору?", a: "Да, ИП/Самозанятость."},
        {q: "Выезжаете в область?", a: "Да, условия в калькуляторе."},
        {q: "Нужна ли сцена?", a: "Не обязательно, работаем и в welcome-зоне."},
        {q: "Можно с детьми?", a: "Да, есть детские программы."},
        {q: "Можно снимать видео?", a: "Да, конечно!"},
        {q: "Какие условия оплаты?", a: "Предоплата 50%, остаток в день шоу."}
    ];
    document.getElementById('faqContainer').innerHTML = faqData.map((f,i) => 
        `<details class="faq-item ${i>=4?'hidden':''}"><summary>${f.q}</summary><div>${f.a}</div></details>`
    ).join('') + '<div class="faq-controls"><button class="btn btn-glass" onclick="showAllFaq(this)">Показать все</button></div>';

    gsap.utils.toArray(".gs-reveal").forEach(elem => {
        gsap.from(elem, { scrollTrigger: { trigger: elem, start: "top 85%" }, y: 30, opacity: 0, duration: 0.8 });
    });
});

/* MENU & MODALS */
function toggleMenu(){ document.getElementById('mobileMenu').classList.toggle('open'); document.querySelector('.burger').classList.toggle('active'); }
function openVideo(){ document.getElementById('modalVideo').classList.add('open'); document.getElementById('vidContainer').innerHTML = '<iframe src="https://rutube.ru/play/embed/a692a6ad3b922abc4cfad5be5898431b?autoplay=1" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>'; }
function closeVideo(){ document.getElementById('modalVideo').classList.remove('open'); document.getElementById('vidContainer').innerHTML = ''; }
function openSchoolModal() { toggleMenu(); document.getElementById('schoolModal').classList.add('open'); }
function closeSchoolModal() { document.getElementById('schoolModal').classList.remove('open'); }
window.showAllFaq = function(btn) { document.querySelectorAll('.faq-item.hidden').forEach(item => item.classList.remove('hidden')); btn.style.display = 'none'; }

/* CALCULATOR LOGIC (RESTORED FULL) */
const travel={ "Вологодская":{fee:9000,cities:{Вологда:9000,Череповец:15000,Сокол:12000}}, "Владимирская":{fee:10000,cities:{Владимир:10000,Ковров:10000,Муром:17000,"Гусь хрустальный":13500}}, "Ивановская":{fee:5000,cities:{Иваново:2000,Кинешма:3500,Шуя:3000,Тейково:2500}}, "Костромская":{fee:3000,cities:{Кострома:2000,Шарья:6000,Нерехта:2000}}, "Ярославская":{fee:1000,cities:{Ярославль:0,Рыбинск:2000,Тутаев:2000,Углич:2000,Ростов:2000}} };
const p=v=>({p:v});
const services={
 kids:{ "Детское шоу (30 мин)": p(11250), "Детское шоу (40 мин)": p(13750), "Индив. детское (30 мин)": {p:21250,d:"Шоу + фокус имениннику"} },
 std:{ "Взрослое шоу (20 мин)": {p:17500,d:"Сет из 3–4 трюков"}, "Взрослое шоу (30 мин)": {p:23750,d:"Универсальный"}, "Взрослое шоу (40 мин)": {p:30000,d:"Расширенный"} },
 close:{ "Микромагия (30 мин)": {p:13000,d:"Фокусы в руках"}, "Микромагия (1 ч)": {p:20000}, "Микромагия (2 ч)": {p:30000} },
 spec:{ "Свадебное (20 мин)": {p:26250}, "Свадебное (30 мин)": {p:32500}, "Корпоратив (20 мин)": {p:26250}, "Корпоратив (30 мин)": {p:32500}, "Юбилей": {p:23750} },
 conc:{ "Мини-шоу «СЕКРЕТ» (1 ч)": {p:150000}, "Спектакль «СЕКРЕТ» (2 ч)": {p:300000} }
};
const catNames = { kids:"Детские", std:"Взрослые", close:"Микромагия", spec:"Спец-шоу", conc:"Концерт" };

function initCalcData() {
    const area = document.getElementById('area');
    Object.keys(travel).forEach(k=>area.add(new Option(k,k)));
    const cat = document.getElementById('cat');
    Object.keys(services).forEach(k=>cat.add(new Option(catNames[k],k)));
}

function updateCities(){
    const area = document.getElementById('area').value;
    const citySel = document.getElementById('city');
    citySel.innerHTML='<option disabled selected>Город</option>'; citySel.disabled=false;
    Object.keys(travel[area].cities).forEach(c=>citySel.add(new Option(c,c)));
}
function updateServicesList(){
    const cat = document.getElementById('cat').value;
    const svc = document.getElementById('svc');
    svc.innerHTML='<option disabled selected>Программа</option>'; svc.disabled=false;
    Object.keys(services[cat]).forEach(k=>svc.add(new Option(k,k)));
}
function showDesc(){
    const cat = document.getElementById('cat').value;
    const val = document.getElementById('svc').value;
    document.getElementById('desc').innerText = services[cat][val].d || '';
}
function toggleSlider(){
    document.getElementById('slider').style.display = document.getElementById('guests').value === 'custom' ? 'flex' : 'none';
}

function nextStep(n){
  if(n===2 && (!document.getElementById('area').value||!document.getElementById('city').value)){alert('Выберите регион и город');return;}
  document.querySelectorAll('.wizard-step').forEach(e=>e.classList.remove('active'));
  document.getElementById('step'+n).classList.add('active');
  document.getElementById('wizProgress').style.width=(n*33)+'%';
}

function calcResult(){
  if (!document.getElementById('svc').value) { alert('Выберите программу'); return; }
  const cat = document.getElementById('cat').value;
  const svcVal = document.getElementById('svc').value;
  let base = services[cat][svcVal].p;
  
  const area = document.getElementById('area').value;
  const city = document.getElementById('city').value;
  
  // Logic: Ярославль = 0 дорога, если область Ярославская
  let road = travel[area].fee;
  if(travel[area].cities[city] !== undefined) road = travel[area].cities[city];
  if(area==='Ярославская' && city==='Ярославль') base += 1000;

  const gSelect = document.getElementById('guests').value;
  const gCount = gSelect === 'custom' ? parseInt(document.getElementById('gRange').value) : parseInt(gSelect);
  const gFee = gSelect === 'custom' ? (gCount-200)*80 : parseInt(gSelect); // Simplified guest logic from original

  const total = base + road + gFee;
  
  document.getElementById('rTotal').innerText=total.toLocaleString()+' ₽';
  
  // Breakdown
  document.getElementById('breakdown').innerHTML = `Услуга: ${base} | Дорога: ${road} | Гости: ${gFee}`;
  document.getElementById('breakdown').style.display = 'block';

  nextStep(3);
}

/* GAME */
function initGame() {
    const deck = document.getElementById('gameDeck'); const msg = document.getElementById('gameMsg'); if (!deck) return; deck.innerHTML = '';
    const lastPlayed = parseInt(localStorage.getItem('game_timestamp')) || 0;
    if (Date.now() - lastPlayed < 24*60*60*1000) { deck.innerHTML = `<div style="padding:15px; border:1px solid #333; border-radius:10px;"><h3>Попытка потрачена</h3></div>`; return; }
    const winIdx = Math.floor(Math.random() * 3);
    for (let i = 0; i < 3; i++) {
        const isWin = (i === winIdx);
        const card = document.createElement('div'); card.className = 'card-play';
        card.innerHTML = `<div class="face back"></div><div class="face front" style="color:#000">${isWin ? 'A♠' : 'J♥'}</div>`;
        card.onclick = () => {
            document.querySelectorAll('.card-play').forEach(el => el.classList.add('flipped'));
            if (isWin) { msg.innerText = 'ПОБЕДА! Скидка 20%'; localStorage.setItem('game_win', 'true'); } 
            else { msg.innerText = 'Увы...'; localStorage.setItem('game_win', 'false'); }
            localStorage.setItem('game_timestamp', Date.now());
        };
        deck.appendChild(card);
    }
}

/* PARTICLES (Light) */
function initThreeJS() { const container = document.getElementById('webgl-canvas'); if(!container) return; }

/* TELEGRAM */
const TG_TOKEN = "7838972787:AAHaLNVe6xqEnzE5qy5Uh2TwSb66LWYIUhI";
const CHAT_ID = 'ВСТАВЬ_СЮДА_ЦИФРЫ_CHAT_ID'; 
document.getElementById('tgForm').onsubmit = async (e) => { e.preventDefault(); /* ... */ };
</script>

</body>
</html>
